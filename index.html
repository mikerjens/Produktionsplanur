<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KRENKARIRNIR ¬∑ Produktionsportal</title>
  <style>
    :root{
      --bg:#0f1115;--panel:#151922;--muted:#8b94a7;--text:#e9eef7;--accent:#7dd3fc;--accent2:#a3e635;--danger:#f87171;--ok:#34d399;--card:#0c0f15;--chip:#1f2531
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;color:var(--text);background:linear-gradient(180deg,#0b0e13 0%,#0f1115 60%,#0d1016 100%) fixed}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .app{max-width:1200px;margin:24px auto;padding:16px}
    .brand{display:flex;align-items:center;gap:12px;cursor:pointer}
    .logo{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#60a5fa);display:grid;place-items:center;font-weight:800;color:#0b0e13;box-shadow:0 6px 18px rgba(125,211,252,.25)}
    h1{margin:0;font-size:22px;letter-spacing:.3px}
    .sub{color:var(--muted);font-size:12px;margin-top:2px}
    header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:12px;padding:14px 18px;border:1px solid #232838;background:linear-gradient(180deg,#151a22,#121723);border-radius:16px}
    .controls{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .select, .search{position:relative}
    input, select, button{background:#0d1118;color:var(--text);border:1px solid #263047;border-radius:12px;padding:10px 12px;font-size:14px}
    select{padding-right:36px}
    button{cursor:pointer}
    .pill{background:var(--chip);border:1px solid #2a3446;border-radius:999px;padding:8px 12px;color:var(--muted);font-size:12px}
    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;margin-top:16px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,#121723,#0e131c);border:1px solid #232b3b;border-radius:16px;overflow:hidden}
    .card .hd{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #232b3b;background:radial-gradient(1200px 300px at -10% -40%,rgba(125,211,252,.06),transparent)}
    .card .bd{padding:14px 16px}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{border-radius:12px;border:1px solid #2a3446;padding:8px 12px;background:#0d1118;color:var(--muted)}
    .tab[aria-selected="true"]{color:#091017;background:linear-gradient(180deg,#9ae6b4,#60d7fb);border-color:#60d7fb;font-weight:600}
    .list{display:flex;flex-direction:column;gap:10px}
    .row{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:10px 12px;border:1px solid #242c3b;border-radius:12px;background:#0c1118}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid #2a3446;border-radius:999px;background:#0b1017;color:var(--muted);font-size:12px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .muted{color:var(--muted)}
    .kicker{font-size:11px;letter-spacing:.4px;color:var(--muted);text-transform:uppercase}
    .title{font-weight:700}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:700px){.two{grid-template-columns:1fr}}
    .section{margin-top:12px}
    .section h3{margin:0 0 8px 0;font-size:14px;color:#cfe6ff}
    .copy{cursor:pointer}
    .ok{color:var(--ok)}
    .danger{color:var(--danger)}
    .print{border:1px dashed #2a3446}
    .footer{margin:18px 0 6px;color:var(--muted);font-size:12px;text-align:center}
    .divider{height:1px;background:#222a3a;margin:10px 0}
    .small{font-size:12px}

    /* Chat UI */
    .chatWrap{display:grid;grid-template-columns:1fr 260px;gap:12px}
    @media (max-width:800px){.chatWrap{grid-template-columns:1fr}}
    .chatBox{display:flex;flex-direction:column;height:520px;border:1px solid #242c3b;border-radius:12px;background:#0b1017}
    .chatMsgs{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:8px}
    .chatInput{display:flex;gap:8px;padding:10px;border-top:1px solid #242c3b}
    .chatInput textarea{flex:1;min-height:42px;max-height:120px;resize:vertical;background:#0d1118;border:1px solid #263047;border-radius:10px;color:var(--text);padding:8px}
    .msg{display:flex;gap:8px}
    .msg .bubble{padding:8px 10px;border-radius:10px;background:#121826;border:1px solid #253149;max-width:82%}
    .msg.me .bubble{background:linear-gradient(180deg,#17324a,#142236);border-color:#2b6aa1}
    .msg .meta{font-size:11px;color:var(--muted);margin-bottom:4px}
    .presence{border:1px solid #242c3b;border-radius:12px;background:#0b1017;padding:10px;height:520px;overflow:auto}
    .presence .who{display:flex;align-items:center;gap:8px;padding:6px 0;border-bottom:1px dashed #1d2534}
    .dot{width:8px;height:8px;border-radius:999px;background:var(--ok)}
    .chanRow{display:flex;gap:10px;align-items:center;margin-bottom:8px}
    .chanRow select{max-width:260px}
    .tiny{font-size:11px;color:var(--muted)}
  </style>

  <!-- Firebase (live chat) -->
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth-compat.js"></script>
</head>
<body>
  <div class="app" id="app">
    <header>
      <div class="brand" id="brand">
        <div class="logo">KR</div>
        <div>
          <h1>KRENKARIRNIR ¬∑ Produktionsportal</h1>
          <div class="sub">V√¶lg dit navn ‚Üí se din plan ¬∑ Call sheets ¬∑ Kontakter ¬∑ Chat</div>
        </div>
      </div>
      <div class="controls">
        <div class="select">
          <select id="personSelect" title="V√¶lg navn">
            <option value="">‚Äî V√¶lg navn ‚Äî</option>
          </select>
        </div>
        <div class="search">
          <input id="search" placeholder="S√∏g i kontakter & call sheets" />
        </div>
        <button id="print" class="print" title="Print eller gem som PDF">üñ®Ô∏è Print</button>
      </div>
    </header>

    <div class="grid">
      <div class="card" id="myDay">
        <div class="hd">
          <div>
            <div class="kicker">Mit skema</div>
            <div class="title" id="myDayTitle">V√¶lg et navn</div>
          </div>
          <div class="tabs">
            <button class="tab" id="tab-day" aria-selected="true">Mit skema</button>
            <button class="tab" id="tab-calls">Call sheets</button>
            <button class="tab" id="tab-contacts">Kontakter</button>
            <button class="tab" id="tab-chat">Chat</button>
          </div>
        </div>
        <div class="bd" id="panel">
          <p class="muted small">V√¶lg dit navn ovenfor for at se dine dage, m√∏detider, locations og dagens program. Klik p√• logoet ‚ÄúKR‚Äù for at nulstille og g√• til start.</p>
        </div>
      </div>

      <div class="card">
        <div class="hd">
          <div>
            <div class="kicker">N√¶ste optagedage</div>
            <div class="title">Overblik</div>
          </div>
        </div>
        <div class="bd" id="nextDays"></div>
      </div>
    </div>

    <div class="footer">Prototype ¬∑ Version 0.3 (chat+auth) ¬∑ ¬© KOVBOY FILM</div>
  </div>

  <script>
  // ---------- DATA ----------
  const people = {
    'Michael Koba':      { role: 'Producer', phone: '591011', email: 'mk@fixer.fo' },
    'Thomas Koba':       { role: 'Instrukt√∏r', phone: '213457', email: 'thomas@kovboyfilm.com' },
    'J√≥nfinn Stenberg':  { role: 'Foto', phone: '296682', email: 'jonfinn_stenberg@hotmail.com' },
    'Hans Petur Hansen': { role: 'Lys', phone: '296652', email: 'hph@kvf.fo' },
    'Anna Kristin B√¶k':  { role: 'Props & design', phone: '265180', email: 'kristin.baek@gmail.com' },
    'H√∏gni Fagraberg':   { role: 'Lyd', phone: '296659', email: 'h.fagraberg@gmail.com' },
    'Ronni Poulsen':     { role: 'Lyd', phone: '794141', email: 'ronni.poulsen@gmail.com' },
    'Julia Jacobsen':    { role: 'Make-up', phone: '251175', email: 'juliajacobsen@outlook.com' },
    'Sunneva H√°berg Eysturstein': { role: 'Location ¬∑ SIRKUS', phone: '503136', email: 'sirkus@sirkus.fo' },
    'Petur H√°berg':      { role: 'Location ¬∑ Hvarvi√∞ 3', phone: '213090', email: '' },
    'R√≥sa Maria Restorff': { role: 'Location ¬∑ Hotel F√∏royar', phone: '', email: 'rosamaria@hotelforoyar.fo' },
    'Katrin Kallsberg':  { role: 'Location ¬∑ Dr. Dahlsg√∏ta 15', phone: '218208', email: 'katrinkallsberg@gmail.com' },
    'Esther √° Fjallinum': { role: 'Skuespiller ¬∑ J√≥hanna', phone: '265069', email: 'estherafjallinum@gmail.com' },
    'Hans T√≥rgar√∞':      { role: 'Skuespiller ¬∑ Holgar', phone: '229342', email: 'hanstorgar@gmail.com' },
    'Elsa Maria Magnusard√≥ttir Olsen': { role: 'Skuespiller ¬∑ Ruth', phone: '507104', email: 'emmocontact@gmail.com' },
    'Hj√°lmar Dam':       { role: 'Skuespiller ¬∑ H√∏gni', phone: '512449', email: 'helmetsdam@gmail.com' },
    'Marius DC':         { role: 'Skuespiller ¬∑ Danny', phone: '582161', email: 'mariusdamchr@gmail.com' },
    'Bj√∏rn Simonsen Ulvedal': { role: 'Skuespiller ¬∑ L√≠ggjas', phone: '222867', email: 'bjorn.simonsen@gmail.com' },
    'Hanna Fl√≥vinsd√≥ttir': { role: 'Skuespiller', phone: '218007', email: 'hannaflov@hotmail.com' },
    'S√≥ley Herad√≥ttir Hammer': { role: 'Skuespiller', phone: '', email: 'soleyhh@torshavn.fo' },
    'S√∫sanna Laursen':   { role: 'Skuespiller', phone: '', email: 'susannal@torshavn.fo' },
    'L√≠v Bruun Muller':  { role: 'Skuespiller', phone: '591414', email: 'livbruunmuller@gmail.com' },
    '√Åsa Helena Brynjard√≥ttir': { role: 'Skuespiller', phone: '261660', email: 'asahelena@outlook.dk' },
    'Edwin Niclassen':   { role: 'Skuespiller', phone: '597264', email: 'edvinhniclasen@gmail.com' },
    'P√°ll Oddur':        { role: 'Skuespiller ¬∑ J√≥hannas mand', phone: '252421', email: 'palloddur@hotmail.com' },
    'Thora Augustinussen': { role: 'Skuespiller ¬∑ Chef/Reception', phone: '', email: 'ta@faer.fo' },
    'Jaspur J√∏rgensen':  { role: 'Skuespiller ¬∑ Kokkur', phone: '227570', email: 'jj@hotelbrandan.fo' },
    'T√≥rur √Årnastein':   { role: 'Skuespiller ¬∑ Kokkur', phone: '266858', email: 'torurarnastein@gmail.com' },
    'Helena':            { role: 'Statist ¬∑ Kaffemaskine', phone: '', email: 'helena.h.jorgensen@gmail.com' },
    'Astri√∞ Gullborgard√≥ttir': { role: 'Statist ¬∑ Advokat', phone: '274450', email: 'gullborgardottir@gmail.com' },
    'T√≥rur vi√∞ √Åir':     { role: 'Statist ¬∑ Advokat', phone: '239403', email: '' },
    'Politibetjent A':   { role: 'Statist ¬∑ Politi', phone: '', email: 'SLE021@politi.dk' },
    'Politibetjent B':   { role: 'Statist ¬∑ Politi', phone: '', email: 'SLE021@politi.dk' },
    'Ukendt statist G':  { role: 'Statist', phone: '', email: '' },
    'Ukendt statist H':  { role: 'Statist', phone: '', email: '' },
    'Ukendt statist I':  { role: 'Statist', phone: '', email: '' },
  };

  const P = (names)=>names.map(n=>({name:n, ...people[n]}));

  const days = [
    { id:'2025-09-23', date:'Tirsdag 23. sept. 2025', title:'Flashback 1A ¬∑ SIRKUS', location:{name:'Sirkus bar', address:'T√≥rshavn'},
      program:[{time:'16:00', text:'Teknisk crew g√∏r scenen i Sirkus klar (HPH, Thomas, J√≥nfinn)'} ,{time:'18:15', text:'Skuespillere m√∏der til makeup & t√∏j (Marius, Hanna, S√≥ley, S√∫sanna) ‚Äì spis hjemmefra'},{time:'19:30', text:'Optagelse starter'},{time:'21:00', text:'SLUT'},],
      crew:P(['Michael Koba','Thomas Koba','J√≥nfinn Stenberg','Hans Petur Hansen','Julia Jacobsen']),
      cast:P(['Marius DC','Hanna Fl√≥vinsd√≥ttir','S√≥ley Herad√≥ttir Hammer','S√∫sanna Laursen','Ukendt statist G','Ukendt statist H','Ukendt statist I','Sunneva H√°berg Eysturstein']) },
    { id:'2025-10-07', date:'Tirsdag 7. okt. 2025', title:'Flashback 2 ¬∑ Festen med L√≠ggjas', location:{name:'Hvarvi√∞ 3, kj.', address:'T√≥rshavn'},
      program:[{time:'14:00', text:'Crew g√∏r scenen klar (Hans Petur, Thomas, Michael, Anna Kristin, Ronni)'},{time:'15:15', text:'Skuespillere & makeup m√∏der i Hugskoti√∞ (Bj√∏rn, L√≠v, √Åsa, Edwin, Julia)'},{time:'16:30', text:'Optagelse p√• location starter'},{time:'19:00', text:'SLUT'},],
      crew:P(['Michael Koba','Thomas Koba','Hans Petur Hansen','Anna Kristin B√¶k','Ronni Poulsen','Julia Jacobsen','Petur H√°berg']),
      cast:P(['Bj√∏rn Simonsen Ulvedal','L√≠v Bruun Muller','√Åsa Helena Brynjard√≥ttir','Edwin Niclassen']) },
    { id:'2025-10-17', date:'Fredag 17. okt. 2025', title:'Klarg√∏ring ¬∑ Terapi-lokale', location:{name:'Aulan ¬∑ Studenterskolen i Hoyd√∏lum'},
      program:[{time:'11:00‚Äì18:00', text:'Lys & instrukt√∏r m√∏der (Hans Petur, Thomas)'},{time:'16:00‚Äì18:00', text:'Foto & lyd m√∏der (J√≥nfinn, H√∏gni)'},{time:'11:00‚Äì16:00', text:'Props/design klarg√∏ring (Anna Kristin)'}],
      crew:P(['Michael Koba','Thomas Koba','J√≥nfinn Stenberg','Hans Petur Hansen','Anna Kristin B√¶k','H√∏gni Fagraberg']), cast:[] },
    { id:'2025-10-19', date:'S√∏ndag 19. okt. 2025', title:'Flashback 4 ¬∑ Ruth flirter med tjener', location:{name:'Hotel Brandan ¬∑ Rest. H√∫sagar√∞ur'},
      program:[{time:'14:00', text:'Lys, instrukt√∏r & producer m√∏der'},{time:'14:45', text:'Props/design m√∏der'},{time:'15:00', text:'Skuespillere & makeup m√∏der'},{time:'15:30', text:'Optagelse begynder'},{time:'18:30', text:'SLUT'}],
      crew:P(['Michael Koba','Thomas Koba','Hans Petur Hansen','Anna Kristin B√¶k','Julia Jacobsen']),
      cast:P(['Elsa Maria Magnusard√≥ttir Olsen','T√≥rur √Årnastein','Jaspur J√∏rgensen']) },
    { id:'2025-11-01', date:'L√∏rdag 1. nov. 2025', title:'Terapi-lokale ¬∑ Optagelser (dag 1)', location:{name:'Aulan ¬∑ Studenterskolen i Hoyd√∏lum'},
      program:[{time:'06:00', text:'M√∏detid crew + skuespillere (Bj√∏rn, Marius). Props m√∏der.'},{time:'06:30', text:'Hj√°lmar & Elsa m√∏der (makeup/t√∏j)'},{time:'07:00', text:'Esther & Hans m√∏der (makeup/t√∏j)'},{time:'07:01', text:'Morgenmad (kaffe/te & rundstykker)'},{time:'08:00', text:'Optagelser starter'},{time:'10:30', text:'Pause/kaffe'},{time:'12:30', text:'Frokost (gryderet fra Jan)'},{time:'15:30', text:'Pause/kaffe'},{time:'15:45', text:'Optagelser forts√¶tter'},{time:'19:00', text:'SLUT'}],
      crew:P(['Michael Koba','Thomas Koba','J√≥nfinn Stenberg','Hans Petur Hansen','Anna Kristin B√¶k','H√∏gni Fagraberg','Julia Jacobsen']),
      cast:P(['Esther √° Fjallinum','Hans T√≥rgar√∞','Elsa Maria Magnusard√≥ttir Olsen','Hj√°lmar Dam','Marius DC','Bj√∏rn Simonsen Ulvedal']) },
    { id:'2025-11-02', date:'S√∏ndag 2. nov. 2025', title:'Terapi-lokale ¬∑ Optagelser (dag 2)', location:{name:'Aulan ¬∑ Studenterskolen i Hoyd√∏lum'},
      program:[{time:'08:00', text:'Optagelser forts√¶tter (som dag 1-tider ‚Äì justeres p√• dagen)'}],
      crew:P(['Michael Koba','Thomas Koba','J√≥nfinn Stenberg','Hans Petur Hansen','Anna Kristin B√¶k','H√∏gni Fagraberg','Julia Jacobsen']),
      cast:P(['Esther √° Fjallinum','Hans T√≥rgar√∞','Elsa Maria Magnusard√≥ttir Olsen','Hj√°lmar Dam','Marius DC','Bj√∏rn Simonsen Ulvedal']) },
    { id:'2025-11-03', date:'Mandag 3. nov. 2025', title:'Flashback 1B ¬∑ Dannys flirt', location:{name:'Studio 016 ¬∑ Hotel F√∏royar'},
      program:[{time:'16:00', text:'Teknisk crew g√∏r scene klar'},{time:'17:30', text:'Skuespillere m√∏der (Marius, Hanna)'},{time:'18:15', text:'Optagelse starter'},{time:'19:30', text:'SLUT'}],
      crew:P(['Michael Koba','Thomas Koba','J√≥nfinn Stenberg','Hans Petur Hansen','Anna Kristin B√¶k','Ronni Poulsen','Julia Jacobsen','R√≥sa Maria Restorff']),
      cast:P(['Marius DC','Hanna Fl√≥vinsd√≥ttir']) },
    { id:'2025-11-05', date:'Onsdag 5. nov. 2025', title:'Esther hjemme-scene', location:{name:'Dr. Dahlsg√∏ta 15 ¬∑ T√≥rshavn'},
      program:[{time:'14:00', text:'Crew m√∏der (Hans Petur, Thomas, Ronni)'},{time:'15:15', text:'Skuespillere m√∏der (P√°ll Oddur, Esther)'},{time:'16:15', text:'Makeup (Julia) ‚Äì optagelse starter'},{time:'19:30', text:'SLUT'}],
      crew:P(['Michael Koba','Thomas Koba','Hans Petur Hansen','Anna Kristin B√¶k','Ronni Poulsen','Julia Jacobsen','Katrin Kallsberg']),
      cast:P(['P√°ll Oddur','Esther √° Fjallinum']) },
    { id:'2025-11-07', date:'Fredag 7. nov. 2025', title:'Chef kontor', location:{name:'Studenterskolen i Hoyd√∏lum'},
      program:[{time:'10:00', text:'Kontor set dressing (Anna Kristin)'},{time:'13:00', text:'Crew m√∏der'},{time:'14:15', text:'Skuespillere m√∏der (Esther, Hans, Thora) ‚Äì makeup/t√∏j'},{time:'16:00', text:'Optagelse starter'},{time:'18:00', text:'Sandwich-pause'},{time:'18:30', text:'Optagelse forts√¶tter'},{time:'20:30', text:'SLUT'}],
      crew:P(['Michael Koba','Thomas Koba','Hans Petur Hansen','Anna Kristin B√¶k','Ronni Poulsen','Julia Jacobsen']),
      cast:P(['Esther √° Fjallinum','Hans T√≥rgar√∞','Thora Augustinussen']) },
    { id:'2025-11-08', date:'L√∏rdag 8. nov. 2025', title:'K√∏rescener & parkering', location:{name:'Studenterskolen i Hoyd√∏lum'},
      program:[{time:'13:00', text:'Crew m√∏der'},{time:'13:15', text:'Skuespillere + Politi m√∏der ‚Äì makeup'},{time:'14:15', text:'Optagelse starter'},{time:'18:00', text:'SLUT'}],
      crew:P(['Michael Koba','Thomas Koba','Hans Petur Hansen','Anna Kristin B√¶k','Ronni Poulsen','Julia Jacobsen']),
      cast:P(['Esther √° Fjallinum','Hans T√≥rgar√∞','Thora Augustinussen','Politibetjent A','Politibetjent B']) },
    { id:'2025-11-22', date:'L√∏rdag 22. nov. 2025', title:'Terapi-lokale ¬∑ Optagelser (dag 3)', location:{name:'Aulan ¬∑ Studenterskolen i Hoyd√∏lum'},
      program:[{time:'06:00', text:'M√∏detid crew + skuespillere (Bj√∏rn, Marius). Props m√∏der.'},{time:'06:30', text:'Hj√°lmar & Elsa m√∏der (makeup/t√∏j)'},{time:'07:00', text:'Esther & Hans m√∏der (makeup/t√∏j)'},{time:'07:01', text:'Morgenmad'},{time:'08:00', text:'Optagelser starter'},{time:'10:30', text:'Pause/kaffe'},{time:'12:30', text:'Frokost'},{time:'15:30', text:'Pause/kaffe'},{time:'15:45', text:'Optagelser forts√¶tter'},{time:'18:00', text:'SLUT'}],
      crew:P(['Michael Koba','Thomas Koba','J√≥nfinn Stenberg','Hans Petur Hansen','Anna Kristin B√¶k','H√∏gni Fagraberg','Julia Jacobsen']),
      cast:P(['Esther √° Fjallinum','Hans T√≥rgar√∞','Elsa Maria Magnusard√≥ttir Olsen','Hj√°lmar Dam','Marius DC','Bj√∏rn Simonsen Ulvedal']) },
    { id:'2025-11-23', date:'S√∏ndag 23. nov. 2025', title:'Terapi-lokale ¬∑ Optagelser (dag 4)', location:{name:'Aulan ¬∑ Studenterskolen i Hoyd√∏lum'},
      program:[{time:'08:00', text:'Optagelser forts√¶tter (som dag 3 ‚Äì justeres p√• dagen)'}],
      crew:P(['Michael Koba','Thomas Koba','J√≥nfinn Stenberg','Hans Petur Hansen','Anna Kristin B√¶k','H√∏gni Fagraberg','Julia Jacobsen']),
      cast:P(['Esther √° Fjallinum','Hans T√≥rgar√∞','Elsa Maria Magnusard√≥ttir Olsen','Hj√°lmar Dam','Marius DC','Bj√∏rn Simonsen Ulvedal']) },
    { id:'2025-11-24', date:'Mandag 24. nov. 2025', title:'Flashback 3 ¬∑ Kaffemaskine + Advokat', location:{name:'Tjarnir'},
      program:[{time:'14:00', text:'Crew g√∏r ‚Äúkaffemaskine‚Äù-scenen klar (Presselogen)'},{time:'15:00', text:'Lyd/stylist/makeup m√∏der (Ronni, Julia, Anna Kristin)'},{time:'15:00', text:'Statister + hovedskuespiller m√∏der (Helena + ??? + Hj√°lmar)'},{time:'15:45', text:'Optagelse starter ¬∑ kaffe-scene'},{time:'17:00', text:'Kaffe-scene slut ¬∑ pause (sandwich)'},{time:'17:15', text:'Ops√¶tning advokat-scene'},{time:'17:30', text:'Statister + Hj√°lmar m√∏der til advokat-scene (Astri√∞, T√≥rur vi√∞ √Åir)'},{time:'19:00', text:'Optagelse advokat-scene starter'},{time:'21:00', text:'SLUT'}],
      crew:P(['Michael Koba','Thomas Koba','J√≥nfinn Stenberg','Anna Kristin B√¶k','Ronni Poulsen','Julia Jacobsen']),
      cast:P(['Hj√°lmar Dam','Helena','Astri√∞ Gullborgard√≥ttir','T√≥rur vi√∞ √Åir']) },
  ];

  // ---------- UI LOGIC ----------
  const $ = sel => document.querySelector(sel);
  const el = (tag, cls, txt) => { const x=document.createElement(tag); if(cls) x.className=cls; if(txt!==undefined) x.textContent=txt; return x };

  const personSelect = $('#personSelect');
  const search = $('#search');
  const panel = $('#panel');
  const nextDays = $('#nextDays');
  const brand = $('#brand');

  // Populate select (only crew + cast + statister)
  const crewOrCast = Object.entries(people)
    .filter(([n,p])=>/(Producer|Instrukt√∏r|Foto|Lys|Lyd|Make-up|Props|Skuespiller|Statist|Location)/.test(p.role))
    .sort((a,b)=>a[0].localeCompare(b[0]));
  for(const [name, info] of crewOrCast){
    const opt = el('option'); opt.value = name; opt.textContent = `${name} ‚Äî ${info.role}`; personSelect.appendChild(opt);
  }

  function renderNextDays(){
    nextDays.innerHTML='';
    const ul = el('div','list');
    for(const d of days){
      const row = el('div','row');
      const left = el('div');
      left.appendChild(el('div','title', d.date + ' ¬∑ ' + d.title));
      left.appendChild(el('div','muted small', d.location.name + (d.location.address ? ' ¬∑ '+d.location.address : '')));
      const right = el('div');
      right.appendChild(el('span','chip', d.program[0]?.time ? 'M√∏detid ' + d.program[0].time : 'Se call sheet'));
      row.append(left,right);
      ul.appendChild(row);
    }
    nextDays.appendChild(ul);
  }

  function renderMySchedule(name){
    const mine = days.filter(d=>[...d.crew,...d.cast].some(x=>x.name===name));
    const info = people[name];
    const wrap = el('div');
    wrap.appendChild(el('div','muted small',`Navn: ${name} ¬∑ ${info?.role||''}`));

    if(mine.length===0){
      wrap.appendChild(el('p','muted','Ingen plan fundet for det valgte navn.'));
      panel.innerHTML=''; panel.appendChild(wrap); return;
    }
    const list = el('div','list');
    for(const d of mine){
      const card = el('div','row');
      const L = el('div');
      L.appendChild(el('div','title', d.date + ' ¬∑ ' + d.title));
      L.appendChild(el('div','muted small', d.location.name));

      const call = d.program[0]?.time || '';
      const R = el('div');
      if(call) R.appendChild(el('span','chip', 'M√∏detid ¬∑ ' + call));
      R.appendChild(el('span','chip copy', 'üìç '+(d.location.address||d.location.name)));
      card.append(L,R);

      const prog = el('div','section');
      const h3 = el('h3'); h3.textContent = 'Dagens program'; prog.appendChild(h3);
      for(const p of d.program){
        const line = el('div','small mono'); line.textContent = (p.time? p.time.padEnd(6,' ')+' ':'') + p.text; prog.appendChild(line);
      }

      const calls = el('div','two section');
      const left = el('div');
      const hCast = el('h3'); hCast.textContent='Skuespillere'; left.appendChild(hCast);
      for(const c of d.cast){ left.appendChild(personRow(c)); }
      const right = el('div');
      const hCrew = el('h3'); hCrew.textContent='Crew'; right.appendChild(hCrew);
      for(const c of d.crew){ right.appendChild(personRow(c)); }
      calls.append(left,right);

      card.style.flexDirection='column';
      card.appendChild(prog);
      card.appendChild(calls);
      list.appendChild(card);
    }

    panel.innerHTML=''; panel.appendChild(wrap); panel.appendChild(el('div','divider')); panel.appendChild(list);
  }

  function personRow(p){
    const row = el('div','small');
    const name = el('div');
    name.innerHTML = `<strong>${p.name}</strong> ¬∑ <span class="muted">${p.role||''}</span>`;
    const contacts = el('div','muted');
    const parts=[];
    if(p.phone) parts.push(`<a href="tel:${p.phone}">üìû ${p.phone}</a>`);
    if(p.email) parts.push(`<a href="mailto:${p.email}">‚úâÔ∏è ${p.email}</a>`);
    contacts.innerHTML = parts.join(' ¬∑ ');
    row.appendChild(name); row.appendChild(contacts);
    row.style.display='flex'; row.style.flexDirection='column'; row.style.gap='2px'; row.style.padding='6px 0';
    return row;
  }

  function renderCallSheets(filter=''){
    const wrap = el('div');
    for(const d of days){
      if(filter && !JSON.stringify(d).toLowerCase().includes(filter.toLowerCase())) continue;
      const card = el('div','row'); card.style.flexDirection='column';
      const head = el('div');
      head.appendChild(el('div','title', d.date + ' ¬∑ ' + d.title));
      head.appendChild(el('div','muted small', d.location.name + (d.location.address? ' ¬∑ '+d.location.address:'')));
      card.appendChild(head);

      const prog = el('div','section');
      const h3 = el('h3'); h3.textContent = 'Program'; prog.appendChild(h3);
      for(const p of d.program){
        const line = el('div','small mono'); line.textContent = (p.time? p.time.padEnd(6,' ')+' ':'') + p.text; prog.appendChild(line);
      }
      card.appendChild(prog);

      const calls = el('div','two section');
      const left = el('div');
      left.appendChild(el('h3','', 'Skuespillere'));
      for(const c of d.cast){ left.appendChild(personRow(c)); }
      const right = el('div');
      right.appendChild(el('h3','', 'Crew'));
      for(const c of d.crew){ right.appendChild(personRow(c)); }
      calls.append(left,right);
      card.appendChild(calls);

      wrap.appendChild(card);
    }
    panel.innerHTML=''; panel.appendChild(wrap);
  }

  function renderContacts(filter=''){
    const wrap = el('div','list');
    const entries = Object.entries(people)
      .filter(([n,p])=>/(Producer|Instrukt√∏r|Foto|Lys|Lyd|Make-up|Props|Skuespiller|Statist|Location)/.test(p.role))
      .filter(([n,p])=> !filter || (n.toLowerCase().includes(filter.toLowerCase()) || (p.role||'').toLowerCase().includes(filter.toLowerCase())))
      .sort((a,b)=>a[0].localeCompare(b[0]));

    for(const [name, p] of entries){
      const row = el('div','row');
      const L = el('div');
      L.appendChild(el('div','title', name));
      L.appendChild(el('div','muted small', p.role || ''));
      const R = el('div');
      if(p.phone) R.appendChild(el('span','chip', 'üìû '+p.phone));
      if(p.email) R.appendChild(el('span','chip', '‚úâÔ∏è '+p.email));
      row.append(L,R);
      wrap.appendChild(row);
    }

    panel.innerHTML=''; panel.appendChild(wrap);
  }

  // ---- CHAT ----
  const chat = {
    firebaseConfig: {
      apiKey: "AIzaSyBtKG38CDCXVe36gxID9HUNmhMu9ooLrAQ",
      authDomain: "krenkarirnir.firebaseapp.com",
      projectId: "krenkarirnir",
      storageBucket: "krenkarirnir.firebasestorage.app",
      messagingSenderId: "116992787112",
      appId: "1:116992787112:web:1e140b9e7b8811b7f5f89d"
    },
    db:null, unsub:null, unsubPresence:null, channel:'#produktion',
    ensure(){
      try{
        if(chat.db) return true;
        const cfg = chat.firebaseConfig;
        if(!cfg || !cfg.apiKey) return false;
        if(!window.firebase) return false;
        if(firebase.apps?.length===0) firebase.initializeApp(cfg);
        // Anonymous auth for access control
        if(!firebase.auth().currentUser){
          firebase.auth().signInAnonymously().catch(console.warn);
        }
        chat.db = firebase.firestore();
        return true;
      }catch(e){ console.warn('Firebase init failed', e); return false; }
    },
    ui(){
      const name = personSelect.value;
      const wrap = el('div','chatWrap');

      // LEFT: messages
      const left = el('div');
      const chanRow = el('div','chanRow');
      const who = el('span','pill'); who.textContent = name? `Du er: ${name}` : 'V√¶lg dit navn for at skrive';
      const chanSel = el('select'); chanSel.id='chanSel';
      chanSel.appendChild(new Option('#produktion (global)','\#produktion'));
      for(const d of days){
        const label = `${d.date.split(' ')[0]} ${d.id} ‚Äî ${d.title}`;
        chanSel.appendChild(new Option(label, d.id));
      }
      chanSel.value = chat.channel;
      chanSel.addEventListener('change',()=>{ chat.channel=chanSel.value; chat.listen(name); });
      chanRow.append(who, chanSel);

      const box = el('div','chatBox');
      const msgs = el('div','chatMsgs'); msgs.id='chatMsgs';
      const input = el('div','chatInput');
      const ta = document.createElement('textarea'); ta.id='chatText'; ta.placeholder = name? 'Skriv en besked‚Ä¶ (Enter for at sende, Shift+Enter = ny linje)' : 'V√¶lg dit navn for at skrive'; ta.disabled = !name;
      ta.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); chat.send(); }});
      const sendBtn = document.createElement('button'); sendBtn.textContent='Send'; sendBtn.onclick=()=>chat.send(); sendBtn.disabled=!name;
      input.append(ta, sendBtn);
      box.append(msgs, input);

      left.append(chanRow, box, el('div','tiny', chat.ensure()? 'Live chat via Firestore' : 'Demo-chat (lokal). Tilf√∏j Firebase-n√∏gler for live.'));

      // RIGHT: presence
      const right = el('div','presence'); right.id='presence';
      right.appendChild(el('div','kicker','Online (seneste 5 min)'));

      wrap.append(left, right);
      panel.innerHTML=''; panel.appendChild(wrap);

      chat.listen(name);
      chat.startPresence(name);
    },
    listen(name){
      const msgs = $('#chatMsgs'); if(!msgs) return;
      if(chat.unsub) { chat.unsub(); chat.unsub=null; }
      if(chat.unsubPresence){ chat.unsubPresence(); chat.unsubPresence=null; }

      if(chat.ensure()){
        const col = chat.db.collection('productions').doc('KRENKARIRNIR').collection('messages');
        chat.unsub = col.where('channel','==',chat.channel).orderBy('ts','asc').limit(200)
          .onSnapshot(s=>{ msgs.innerHTML=''; s.forEach(doc=>chat.renderMsg(doc.data(), name)); msgs.scrollTop=msgs.scrollHeight; });
        chat.unsubPresence = chat.db.collection('productions').doc('KRENKARIRNIR').collection('presence')
          .where('lastActive','>', new Date(Date.now()-5*60*1000))
          .onSnapshot(s=>{ const pEl=$('#presence'); if(!pEl) return; const nodes=[]; nodes.push(el('div','tiny',new Date().toLocaleTimeString()+': opdateret'));
            s.forEach(doc=>{ const d=doc.data(); const who=el('div','who'); who.appendChild(el('div','dot')); who.appendChild(el('div',null,`${d.name} ¬∑ ${d.role||''}`)); nodes.push(who); });
            pEl.innerHTML='<div class="kicker">Online (seneste 5 min)</div>'; nodes.forEach(n=>pEl.appendChild(n)); });
      } else {
        const key = 'chat_'+chat.channel;
        const arr = JSON.parse(localStorage.getItem(key)||'[]');
        msgs.innerHTML='';
        arr.slice(-200).forEach(m=>chat.renderMsg(m, name));
      }
    },
    renderMsg(m, me){
      const who = m.user || 'Ukendt';
      const at = m.ts? (m.ts.toDate? m.ts.toDate(): new Date(m.ts)) : new Date();
      const row = el('div','msg'+(who===me?' me':''));
      const wrap = el('div','bubble');
      const meta = el('div','meta', `${who}${m.role? ' ¬∑ '+m.role:''} ‚Äî ${at.toLocaleTimeString()}`);
      const body = el('div',null, m.text);
      wrap.append(meta, body); row.append(wrap); $('#chatMsgs').appendChild(row);
    },
    async send(){
      const ta = $('#chatText'); if(!ta || !ta.value.trim()) return;
      const user = personSelect.value; if(!user){ alert('V√¶lg dit navn for at skrive.'); return; }
      const role = (people[user]||{}).role || '';
      const uid = (firebase.auth().currentUser && firebase.auth().currentUser.uid) || null;
      const msg = { user, role, text: ta.value.trim(), channel: chat.channel, ts: firebase.firestore.FieldValue.serverTimestamp(), uid };
      ta.value='';
      if(chat.ensure()){
        await chat.db.collection('productions').doc('KRENKARIRNIR').collection('messages').add(msg);
        const presenceDoc = chat.db.collection('productions').doc('KRENKARIRNIR').collection('presence').doc(uid || user);
        await presenceDoc.set({name:user, role, lastActive: firebase.firestore.FieldValue.serverTimestamp()}, {merge:true});
      } else {
        const key='chat_'+chat.channel; const arr=JSON.parse(localStorage.getItem(key)||'[]'); arr.push({...msg, ts: Date.now()}); localStorage.setItem(key, JSON.stringify(arr)); chat.listen(user);
      }
    },
    startPresence(name){
      if(!name || !chat.ensure()) return;
      const role = (people[name]||{}).role || '';
      const uid = (firebase.auth().currentUser && firebase.auth().currentUser.uid) || name;
      const ping = ()=> chat.db.collection('productions').doc('KRENKARIRNIR').collection('presence').doc(uid).set({name:name, role, lastActive: firebase.firestore.FieldValue.serverTimestamp()},{merge:true});
      ping(); chat._presenceTimer && clearInterval(chat._presenceTimer); chat._presenceTimer = setInterval(ping, 60*1000);
    }
  };

  // Tabs
  const tabDay = $('#tab-day'), tabCalls = $('#tab-calls'), tabContacts = $('#tab-contacts'), tabChat = $('#tab-chat');
  function selectTab(tab){
    for(const t of [tabDay,tabCalls,tabContacts,tabChat]) t.setAttribute('aria-selected','false');
    tab.setAttribute('aria-selected','true');
  }

  tabDay.addEventListener('click',()=>{ selectTab(tabDay); const v=personSelect.value; if(v) renderMySchedule(v); else panel.innerHTML='<p class="muted small">V√¶lg dit navn for at se dit skema.</p>'; });
  tabCalls.addEventListener('click',()=>{ selectTab(tabCalls); renderCallSheets(search.value.trim()); });
  tabContacts.addEventListener('click',()=>{ selectTab(tabContacts); renderContacts(search.value.trim()); });
  tabChat.addEventListener('click',()=>{ selectTab(tabChat); chat.ui(); });

  // Events
  personSelect.addEventListener('change',()=>{
    const v = personSelect.value; $('#myDayTitle').textContent = v? ('Plan for '+v) : 'V√¶lg et navn';
    const activeTab = [tabDay,tabCalls,tabContacts,tabChat].find(t=>t.getAttribute('aria-selected')==='true');
    if(activeTab===tabDay){ if(!v){ panel.innerHTML='<p class="muted small">V√¶lg dit navn for at se dit skema.</p>'; return } renderMySchedule(v); }
    if(activeTab===tabChat){ chat.ui(); }
  });

  search.addEventListener('input',()=>{
    if(tabCalls.getAttribute('aria-selected')==='true') renderCallSheets(search.value.trim());
    if(tabContacts.getAttribute('aria-selected')==='true') renderContacts(search.value.trim());
  });

  $('#print').addEventListener('click',()=>window.print());
  brand.addEventListener('click',()=>{ personSelect.value=''; search.value=''; selectTab(tabDay); $('#myDayTitle').textContent='V√¶lg et navn'; panel.innerHTML='<p class="muted small">V√¶lg dit navn for at se dit skema.</p>'; window.scrollTo({top:0,behavior:'smooth'}); });

  // Init
  renderNextDays();
  </script>
</body>
</html>
